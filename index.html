<!DOCTYPE HTML>
<html>
  <head>
    <title>Multilanguage PhoneGap Application Example</title>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/i18next.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
        var
            language = 'English';
            code = getCode(language);
            
        console.log('appInit');
        console.log('language = ' + language + ', code = ' + code);
            
        function getLanguage()
        {
            navigator.globalization.getPreferredLanguage
            (
                function(lang)
                {
                    language = lang.value;
                    code = getCode(lang.value);
                    
                    console.log('Success getting language -- getPreferredLanguage() success callback called!');
                    console.log('language = ' + language + ', code = ' + code);
                    console.log(lang);
                    
                    i18n.setLng(code, function(t)
                    {
                        $('body').i18n();
                    });
                },
                function(error)
                {
                    console.log('Failed to get language -- getPreferredLanguage() error callback called!');
                    console.log(error);
                    
                    alert(i18n.t('messages.error'));
                }
            );
        }
        
        function getCode(lang)
        {
            var
                dict = {},
                lang = lang.toLocaleLowerCase(),
                code = lang.substring(0, 2);
            
            /**
             * Fix certain languages' codes
             * 
             * JavaScript escapes: http://www.rishida.net/tools/conversion/
             * More languages (ISO 639-1 codes): http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes
             */
            dict["polski"] = "pl"; //Polish
            dict["suomi"] = "fi"; //Finnish
            dict["nederlands"] = "nl"; //Dutch
            dict["magyar"] = "hu"; //Hungarian
            dict["filipino"] = "fil"; //Filipino
            dict["\u4E2D\u6587"] = "zh"; //Chinese
            dict["latvie\u0161u"] = "lv"; //Latvian
            dict["sloven\u010Dina"] = "sk"; //Slovak
            dict["\u010De\u0161tina"] = "cs"; //Czech
            dict["\u0E44\u0E17\u0E22"] = "th"; //Thai
            dict["t\u00FCrk\u00E7e"] = "tr"; //Turkish
            dict["lietuvi\u0173"] = "lt"; //Lithuanian
            dict["portugu\u00EAs"] = "pt"; //Portuguese
            dict["\uD55C\uAD6D\uC5B4"] = "ko"; //Korean
            dict["bahasa indonesia"] = "id"; //Indonesian
            dict["ti\u1EBFng vi\u1EC7t"] = "vi"; //Vietnamese
            dict["norsk bokm\u00E5l"] = "nb"; //Norwegian Bokm√•l
            dict["\u0641\u0627\u0631\u0633\u06CC"] = "fa"; //Persian
            dict["\u05E2\u05D1\u05E8\u05D9\u05EA"] = "he"; //Modern Hebrew
            dict["\u0441\u0440\u043F\u0441\u043A\u0438"] = "sr"; //Serbian
            dict["\u0627\u0644\u0639\u0631\u0628\u064A\u0629"]= "ar"; //Arabic
            dict["\u0440\u0443\u0441\u0441\u043A\u0438\u0439"] = "ru"; //Russian
            dict["\u03B5\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC"] = "el"; //Modern Greek
            dict["\u0431\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438"] = "bg"; //Bulgarian
            dict["\u0443\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430"] = "uk"; //Ukrainian
            
            for(key in dict)
            {
                if(dict.hasOwnProperty(key))
                {
                    if(key === lang) code = dict[key];
                }
            }
            
            return code;
        }
        
        function displayLanguage()
        {
            getLanguage();
            
            var message = i18n.t('messages.success', {language: language}) + ' [' + code + '].';

            alert(message);
        }
        
        function deviceReadyHandler()
        {
            /**
             * i18next -- http://i18next.com/
             */
            i18n.init
            ({
                lng: code,
                ns: 'general',
                useCookie: false,
                fallbackLng: 'en',
                resGetPath: 'locales/__ns__.__lng__.json'
            }, function()
            {
                $('body').i18n();
            });

            getLanguage();
        }
        
        document.addEventListener('deviceready', deviceReadyHandler, false);
    </script>
  </head>
  <body>
    <button onclick="displayLanguage()" data-i18n="buttons.language">buttons.language</button>
  </body>
</html>