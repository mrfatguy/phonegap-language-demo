<!DOCTYPE HTML>
<html>
  <head>
    <title>Multilanguage PhoneGap Application Example</title>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/i18next.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
        var
            language = 'English';
            code = getCode(language);
            
        console.log('appInit');
        console.log('language = ' + language + ', code = ' + code);
            
        function getLanguage()
        {
            navigator.globalization.getPreferredLanguage
            (
                function(lang)
                {
                    language = lang.value;
                    code = getCode(lang.value);
                    
                    console.log('Success getting language -- getPreferredLanguage() success callback called!');
                    console.log('language = ' + language + ', code = ' + code);
                    console.log(lang);
                    
                    i18n.setLng(code, function(t)
                    {
                        $('body').i18n();
                    });
                },
                function(error)
                {
                    console.log('Failed to get language -- getPreferredLanguage() error callback called!');
                    console.log(error);
                    
                    alert(i18n.t('messages.error'));
                }
            );
        }
        
        function getCode(lang)
        {
            var
                dict = {},
                lang = lang.toLocaleLowerCase(),
                code = lang.substring(0, 2);
            
            //Fix certain languages' codes
            dict["bahasa indonesia"] = "id";
            dict["\u010De\u0161tina"] = "cs"; //Czech
            dict["filipino"] = "fil"; //Filipino
            dict["pilipino"] = "fil"; //Filipino
            dict["latviešu"] = "lv"; //Latvian
            dict["lietuvių"] = "lt"; //Lithuanian
            dict["magyar"] = "hu"; //Hungarian
            dict["nederlands"] = "nl"; //Dutch
            dict["vlaams"] = "nl"; //Dutch
            dict["norsk bokmål"] = "nb"; //Norwegian Bokmål
            dict["polski"] = "pl"; //Polish
            dict["português"] = "pt"; //Portuguese
            dict["slovenčina"] = "sk"; //Slovak
            dict["suomi"] = "fi"; //Finnish
            dict["tiếng việt"] = "vi"; //Vietnamese
            dict["türkçe"] = "tr"; //Turkish
            dict["ελληνικά"] = "el"; //Modern Greek
            dict["български"] = "bg"; //Bulgarian
            dict["\u0440\u0443\u0441\u0441\u043A\u0438\u0439"] = "ru"; //Russian
            
            for(key in dict)
            {
                if(dict.hasOwnProperty(key))
                {
                    if(key === lang) code = dict[key];
                }
            }
            
            return code;
        }
        
        function displayLanguage()
        {
            getLanguage();
            
            var message = i18n.t('messages.success', {language: language}) + ' [' + code + '].';

            alert(message);
        }
        
        function deviceReadyHandler()
        {
            /**
             * i18next -- http://i18next.com/
             */
            i18n.init
            ({
                lng: code,
                ns: 'general',
                useCookie: false,
                fallbackLng: 'en',
                resGetPath: 'locales/__ns__.__lng__.json'
            }, function()
            {
                $('body').i18n();
            });

            getLanguage();
        }
        
        document.addEventListener('deviceready', deviceReadyHandler, false);
    </script>
  </head>
  <body>
    <button onclick="displayLanguage()" data-i18n="buttons.language">buttons.language</button>
  </body>
</html>